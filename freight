#!/bin/bash
set -euo pipefail

# Get script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BIN_DIR="$SCRIPT_DIR/bin"

# Version information
VERSION="0.1.0"

# Usage information
usage() {
    cat << EOF
freight - NFS Migration Suite

USAGE:
    freight <COMMAND> [OPTIONS] [ARGS...]

COMMANDS:
    scan        Scan directory and generate metadata
    migrate     Migrate files between locations
    clean       Clean up migration artifacts
    sync        Synchronize files between locations
    verify      Verify migration integrity

OPTIONS:
    -h, --help      Show this help message
    --version       Show version information

DESCRIPTION:
    Freight is a hybrid Rust/Bash NFS migration suite that provides
    tools for scanning, migrating, and managing file transfers.

EXAMPLES:
    freight scan /path/to/source      # Scan source directory
    freight migrate /src /dst         # Migrate files from src to dst
    freight clean /path/to/migration  # Clean up migration artifacts

For command-specific help, use:
    freight <COMMAND> --help

EOF
}

# Show version information
show_version() {
    echo "freight $VERSION"
}

# Main function
main() {
    # Handle no arguments
    if [[ $# -eq 0 ]]; then
        usage
        exit 1
    fi
    
    # Handle global options
    case "$1" in
        -h|--help)
            usage
            exit 0
            ;;
        --version)
            show_version
            exit 0
            ;;
    esac
    
    # Extract command
    local command="$1"
    shift
    
    # Route to appropriate tool
    case "$command" in
        scan)
            exec "$BIN_DIR/freight-scan" "$@"
            ;;
        migrate)
            exec "$BIN_DIR/freight-migrate" "$@"
            ;;
        clean)
            exec "$BIN_DIR/freight-clean" "$@"
            ;;
        sync)
            exec "$BIN_DIR/freight-sync" "$@"
            ;;
        verify)
            exec "$BIN_DIR/freight-verify" "$@"
            ;;
        *)
            echo "Error: Unknown command '$command'" >&2
            echo "" >&2
            echo "Available commands: scan, migrate, clean, sync, verify" >&2
            echo "Use 'freight --help' for more information." >&2
            exit 1
            ;;
    esac
}

# Run main function
main "$@"